<script src="http://code.jquery.com/jquery-git1.min.js"></script>
<script src="/assets/jquery-sortable-lists.js"></script>
<script type="text/javascript">
$(function()
{
  var options = {
    placeholderCss: {'background-color': '#ff8'},
    hintCss: {'background-color':'#bbf'},
        onChange: function( cEl )
        {
            console.log( 'onChange' );
        },
        complete: function( cEl )
        {
            console.log( 'complete' );
        },
    isAllowed: function( cEl, hint, target )
    {
      // Be carefull if you test some ul/ol elements here.
      // Sometimes ul/ols are dynamically generated and so they have not some attributes as natural ul/ols.
      // Be careful also if the hint is not visible. It has only display none so it is at the previouse place where it was before(excluding first moves before showing).
      if(hint.parents('li').first().data('module') === 'c' && cEl.data('module') !== 'c')
      {
        hint.css('background-color', '#ff9999');
        return false;
      }
      else
      {
        hint.css('background-color', '#99ff99');
        return true;
      }
    },
    opener: {
       active: true,
       // close: '/assets/Remove2.png',
       // open: '/assets/Add2.png',
       close: <%= link_to image_tag("Remove2.png"); %>
       open: <%= link_to image_tag("Add2.png"); %>
       openerCss: {
         'display': 'inline-block',
         'width': '18px',
         'height': '18px',
         'float': 'left',
         'margin-left': '-35px',
         'margin-right': '5px',
         'background-position': 'center center',
         'background-repeat': 'no-repeat'
       },
       openerClass: ''
    },
    ignoreClass: 'clickable'
  };

  $('#sTree2, #sTree').sortableLists(options);

  $('#toArrBtn').on('click', function(){ console.log($('#sTree2').sortableListsToArray()); });
  $('#toHierBtn').on('click', function() { console.log($('#sTree2').sortableListsToHierarchy()); });
  $('#toStrBtn').on('click', function() { console.log($('#sTree2').sortableListsToString()); });
  $('.descPicture').on('click', function(e) { $(this).toggleClass('descPictureClose'); });

  $('.clickable').on('click', function(e) { alert('Click works fine! IgnoreClass stops onDragStart event.'); });

  /* Scrolling anchors */
  $('#toPictureAnch').on('click', function(e) { scrollToAnch('pictureAnch'); });
  $('#toBaseElementAnch').on('click', function(e) { scrollToAnch('baseElementAnch'); });
  $('#toBaseElementAnch2').on('click', function(e) { scrollToAnch('baseElementAnch'); });
  $('#toCssPatternAnch').on('click', function(e) { scrollToAnch('cssPatternAnch'); });

  function scrollToAnch(id)
  {
    $('html, body').animate({
      scrollTop: $("#" + id).offset().top
    }, 750);
    return false;
  }

});

</script>

<p id="notice"><%= notice %></p>

<h1>Listing Plans</h1>

<br>

<%= link_to 'New Plan', new_plan_path %>

<ul class="sTree2 listsClass" id="sTree2">
  <% @plans.each do |plan| p_id = plan.id %>
  <li>
    <div><%= plan.goal %><span class="actionSet"><%= link_to image_tag("edit.png"), edit_plan_path(plan) %> | <%= link_to image_tag("delete.png"), plan, method: :delete, data: { confirm: 'Are you sure?' } %></span></div>
    <%= render :partial => "kpis/select", locals: {p_id: p_id} %>
  </li>
  <% end %>
</ul>
